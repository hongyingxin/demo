<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Threshold é˜ˆå€¼è¯¦è§£ Demo</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      color: #333;
    }

    .demo-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-top: 30px;
    }

    .demo-section {
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .demo-section h2 {
      margin: 0 0 15px 0;
      color: #4CAF50;
      font-size: 20px;
      text-align: center;
    }

    .threshold-value {
      text-align: center;
      font-size: 36px;
      font-weight: bold;
      color: #333;
      margin-bottom: 15px;
    }

    .scroll-area {
      height: 300px;
      overflow-y: auto;
      border: 2px solid #ddd;
      background: #fafafa;
      position: relative;
      border-radius: 4px;
    }

    /* è§†å£æŒ‡ç¤ºå™¨ */
    .viewport-indicator {
      position: sticky;
      top: 0;
      left: 0;
      right: 0;
      height: 100%;
      border: 3px dashed #2196F3;
      background: rgba(33, 150, 243, 0.05);
      pointer-events: none;
      z-index: 1;
    }

    .viewport-label {
      position: absolute;
      top: 10px;
      left: 10px;
      background: #2196F3;
      color: white;
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: bold;
    }

    /* ç›®æ ‡å…ƒç´  */
    .target-element {
      width: 80%;
      height: 200px;
      margin: 400px auto;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      position: relative;
      transition: all 0.3s ease;
    }

    .target-element.triggered {
      transform: scale(1.05);
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    .visibility-bar {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(76, 175, 80, 0.8);
      transition: height 0.1s ease;
      border-radius: 0 0 8px 8px;
    }

    .visibility-text {
      font-size: 24px;
      z-index: 1;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .trigger-status {
      font-size: 14px;
      margin-top: 10px;
      z-index: 1;
    }

    /* è¯´æ˜åŒºåŸŸ */
    .explanation {
      margin-top: 40px;
      padding: 30px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .explanation h2 {
      color: #333;
      margin-bottom: 20px;
    }

    .threshold-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .threshold-item {
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #4CAF50;
    }

    .threshold-item strong {
      color: #4CAF50;
      font-size: 18px;
    }

    .threshold-item p {
      margin: 10px 0 0 0;
      color: #666;
      font-size: 14px;
      line-height: 1.5;
    }

    /* å¤šé˜ˆå€¼æ¼”ç¤º */
    .multi-threshold-demo {
      margin-top: 40px;
      padding: 30px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .events-log {
      margin-top: 20px;
      padding: 15px;
      background: #2d3436;
      color: #dfe6e9;
      border-radius: 4px;
      font-family: monospace;
      font-size: 12px;
      max-height: 200px;
      overflow-y: auto;
    }

    .log-entry {
      margin-bottom: 5px;
      padding: 5px;
      background: rgba(255,255,255,0.05);
      border-radius: 2px;
    }

    .log-threshold {
      color: #4CAF50;
      font-weight: bold;
    }

    .log-direction {
      color: #74b9ff;
    }

    /* æç¤º */
    .tip {
      margin: 20px 0;
      padding: 15px;
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      border-radius: 4px;
      color: #856404;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Intersection Observer Thresholdï¼ˆé˜ˆå€¼ï¼‰è¯¦è§£</h1>
    
    <div class="tip">
      ğŸ’¡ <strong>é‡è¦æ¦‚å¿µï¼š</strong>threshold è¡¨ç¤ºå…ƒç´ çš„<strong>å¯è§æ¯”ä¾‹</strong>ï¼Œè€Œä¸æ˜¯æ¶ˆå¤±æ¯”ä¾‹ï¼
      å‘ä¸‹æ»šåŠ¨æŸ¥çœ‹ä¸åŒé˜ˆå€¼çš„è§¦å‘æ—¶æœºã€‚
    </div>

    <!-- ä¸‰ä¸ªç‹¬ç«‹çš„æ¼”ç¤º -->
    <div class="demo-grid">
      <!-- Threshold = 0 -->
      <div class="demo-section">
        <h2>Threshold = 0</h2>
        <div class="threshold-value">0</div>
        <div class="scroll-area" id="scroll1">
          <div class="viewport-indicator">
            <div class="viewport-label">è§†å£åŒºåŸŸ</div>
          </div>
          <div class="target-element" id="target1">
            <div class="visibility-bar" id="bar1"></div>
            <div class="visibility-text">å¯è§: <span id="ratio1">0%</span></div>
            <div class="trigger-status" id="status1">ç­‰å¾…è§¦å‘...</div>
          </div>
        </div>
        <p style="margin-top: 10px; text-align: center; color: #666; font-size: 14px;">
          å…ƒç´ åˆšå‡ºç°ä¸€ä¸ªåƒç´ å°±è§¦å‘
        </p>
      </div>

      <!-- Threshold = 0.5 -->
      <div class="demo-section">
        <h2>Threshold = 0.5</h2>
        <div class="threshold-value">0.5</div>
        <div class="scroll-area" id="scroll2">
          <div class="viewport-indicator">
            <div class="viewport-label">è§†å£åŒºåŸŸ</div>
          </div>
          <div class="target-element" id="target2">
            <div class="visibility-bar" id="bar2"></div>
            <div class="visibility-text">å¯è§: <span id="ratio2">0%</span></div>
            <div class="trigger-status" id="status2">ç­‰å¾…è§¦å‘...</div>
          </div>
        </div>
        <p style="margin-top: 10px; text-align: center; color: #666; font-size: 14px;">
          å…ƒç´ æ˜¾ç¤º50%æ—¶è§¦å‘
        </p>
      </div>

      <!-- Threshold = 1.0 -->
      <div class="demo-section">
        <h2>Threshold = 1.0</h2>
        <div class="threshold-value">1.0</div>
        <div class="scroll-area" id="scroll3">
          <div class="viewport-indicator">
            <div class="viewport-label">è§†å£åŒºåŸŸ</div>
          </div>
          <div class="target-element" id="target3">
            <div class="visibility-bar" id="bar3"></div>
            <div class="visibility-text">å¯è§: <span id="ratio3">0%</span></div>
            <div class="trigger-status" id="status3">ç­‰å¾…è§¦å‘...</div>
          </div>
        </div>
        <p style="margin-top: 10px; text-align: center; color: #666; font-size: 14px;">
          å…ƒç´ 100%å®Œå…¨æ˜¾ç¤ºæ—¶è§¦å‘
        </p>
      </div>
    </div>

    <!-- è¯¦ç»†è¯´æ˜ -->
    <div class="explanation">
      <h2>ğŸ“– Threshold è¯¦ç»†è¯´æ˜</h2>
      
      <div class="threshold-list">
        <div class="threshold-item">
          <strong>threshold: 0</strong>
          <p>
            å½“ç›®æ ‡å…ƒç´ ä¸æ ¹å…ƒç´ ï¼ˆè§†å£ï¼‰æœ‰ä»»ä½•äº¤é›†æ—¶è§¦å‘ã€‚<br>
            å³ä½¿åªæœ‰1ä¸ªåƒç´ è¿›å…¥è§†å£ä¹Ÿä¼šè§¦å‘å›è°ƒã€‚<br>
            å¸¸ç”¨äºï¼šæ‡’åŠ è½½ã€æ— é™æ»šåŠ¨ç­‰ã€‚
          </p>
        </div>
        
        <div class="threshold-item">
          <strong>threshold: 0.5</strong>
          <p>
            å½“ç›®æ ‡å…ƒç´ æœ‰50%é¢ç§¯è¿›å…¥è§†å£æ—¶è§¦å‘ã€‚<br>
            å…ƒç´ ä¸€åŠå¯è§æ—¶æ‰§è¡Œå›è°ƒã€‚<br>
            å¸¸ç”¨äºï¼šåŠ¨ç”»è§¦å‘ã€æ•°æ®ç»Ÿè®¡ç­‰ã€‚
          </p>
        </div>
        
        <div class="threshold-item">
          <strong>threshold: 1.0</strong>
          <p>
            å½“ç›®æ ‡å…ƒç´ 100%å®Œå…¨è¿›å…¥è§†å£æ—¶è§¦å‘ã€‚<br>
            æ•´ä¸ªå…ƒç´ éƒ½åœ¨è§†å£å†…æ‰æ‰§è¡Œå›è°ƒã€‚<br>
            å¸¸ç”¨äºï¼šç¡®ä¿å…ƒç´ å®Œå…¨å¯è§çš„åœºæ™¯ã€‚
          </p>
        </div>
        
        <div class="threshold-item">
          <strong>threshold: [0, 0.25, 0.5, 0.75, 1]</strong>
          <p>
            å¯ä»¥è®¾ç½®å¤šä¸ªé˜ˆå€¼ï¼Œåˆ†åˆ«åœ¨0%ã€25%ã€50%ã€75%ã€100%æ—¶è§¦å‘ã€‚<br>
            ç”¨äºéœ€è¦ç²¾ç¡®è¿½è¸ªå¯è§åº¦å˜åŒ–çš„åœºæ™¯ã€‚
          </p>
        </div>
      </div>
    </div>

    <!-- å¤šé˜ˆå€¼æ¼”ç¤º -->
    <div class="multi-threshold-demo">
      <h2>ğŸ¯ å¤šé˜ˆå€¼æ¼”ç¤º</h2>
      <p>è¿™ä¸ªæ¼”ç¤ºä½¿ç”¨äº†å¤šä¸ªé˜ˆå€¼ï¼š[0, 0.25, 0.5, 0.75, 1]</p>
      
      <div class="scroll-area" style="height: 400px;" id="scroll4">
        <div class="viewport-indicator">
          <div class="viewport-label">è§†å£åŒºåŸŸ</div>
        </div>
        <div class="target-element" id="target4" style="height: 300px;">
          <div class="visibility-bar" id="bar4"></div>
          <div class="visibility-text" style="font-size: 36px;">å¯è§: <span id="ratio4">0%</span></div>
          <div class="trigger-status" id="status4">ç­‰å¾…è§¦å‘...</div>
        </div>
      </div>
      
      <div class="events-log" id="eventsLog">
        <div style="font-weight: bold; margin-bottom: 10px;">ğŸ“‹ äº‹ä»¶æ—¥å¿—ï¼ˆå¤šé˜ˆå€¼ï¼‰</div>
      </div>
    </div>
  </div>

  <script>
    // åˆ›å»ºä¸‰ä¸ªç‹¬ç«‹çš„è§‚å¯Ÿå™¨
    function createDemo(scrollId, targetId, barId, ratioId, statusId, threshold) {
      const scrollContainer = document.getElementById(scrollId);
      const target = document.getElementById(targetId);
      const bar = document.getElementById(barId);
      const ratioDisplay = document.getElementById(ratioId);
      const statusDisplay = document.getElementById(statusId);
      
      let hasTriggered = false;
      
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          const ratio = entry.intersectionRatio;
          const percentage = (ratio * 100).toFixed(1);
          
          // æ›´æ–°å¯è§åº¦æ¡
          bar.style.height = `${ratio * 100}%`;
          
          // æ›´æ–°å¯è§åº¦æ–‡æœ¬
          ratioDisplay.textContent = `${percentage}%`;
          
          // æ£€æŸ¥æ˜¯å¦è¾¾åˆ°é˜ˆå€¼
          if (ratio >= threshold && !hasTriggered) {
            hasTriggered = true;
            target.classList.add('triggered');
            statusDisplay.textContent = 'âœ… å·²è§¦å‘ï¼';
            statusDisplay.style.color = '#4CAF50';
          } else if (ratio < threshold && hasTriggered) {
            hasTriggered = false;
            target.classList.remove('triggered');
            statusDisplay.textContent = 'ç­‰å¾…è§¦å‘...';
            statusDisplay.style.color = 'white';
          }
        });
      }, {
        root: scrollContainer,
        threshold: [0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1] // ä½¿ç”¨å¤šä¸ªé˜ˆå€¼ä»¥è·å¾—å¹³æ»‘æ›´æ–°
      });
      
      observer.observe(target);
    }

    // åˆ›å»ºå¤šé˜ˆå€¼æ¼”ç¤º
    function createMultiThresholdDemo() {
      const scrollContainer = document.getElementById('scroll4');
      const target = document.getElementById('target4');
      const bar = document.getElementById('bar4');
      const ratioDisplay = document.getElementById('ratio4');
      const statusDisplay = document.getElementById('status4');
      const eventsLog = document.getElementById('eventsLog');
      
      const thresholds = [0, 0.25, 0.5, 0.75, 1];
      let lastCrossedThreshold = -1;
      
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          const ratio = entry.intersectionRatio;
          const percentage = (ratio * 100).toFixed(1);
          
          // æ›´æ–°å¯è§åº¦æ¡
          bar.style.height = `${ratio * 100}%`;
          
          // æ›´æ–°å¯è§åº¦æ–‡æœ¬
          ratioDisplay.textContent = `${percentage}%`;
          
          // æ£€æŸ¥è·¨è¶Šçš„é˜ˆå€¼
          thresholds.forEach((threshold, index) => {
            if (ratio >= threshold && lastCrossedThreshold < index) {
              // å‘ä¸Šè·¨è¶Šé˜ˆå€¼
              lastCrossedThreshold = index;
              addLog(`å‘ä¸Šè·¨è¶Šé˜ˆå€¼ ${threshold} (${threshold * 100}%)`, 'up');
              target.classList.add('triggered');
              statusDisplay.textContent = `å½“å‰è·¨è¶Š: ${threshold * 100}%`;
            } else if (ratio < threshold && lastCrossedThreshold >= index) {
              // å‘ä¸‹è·¨è¶Šé˜ˆå€¼
              if (ratio < thresholds[lastCrossedThreshold]) {
                lastCrossedThreshold = index - 1;
                addLog(`å‘ä¸‹è·¨è¶Šé˜ˆå€¼ ${threshold} (${threshold * 100}%)`, 'down');
                if (lastCrossedThreshold < 0) {
                  target.classList.remove('triggered');
                  statusDisplay.textContent = 'ç­‰å¾…è§¦å‘...';
                } else {
                  statusDisplay.textContent = `å½“å‰è·¨è¶Š: ${thresholds[lastCrossedThreshold] * 100}%`;
                }
              }
            }
          });
        });
      }, {
        root: scrollContainer,
        threshold: thresholds
      });
      
      observer.observe(target);
      
      function addLog(message, direction) {
        const time = new Date().toLocaleTimeString();
        const entry = document.createElement('div');
        entry.className = 'log-entry';
        entry.innerHTML = `
          ${time} - 
          <span class="log-direction">${direction === 'up' ? 'ğŸ“ˆ' : 'ğŸ“‰'}</span> 
          ${message}
        `;
        
        eventsLog.insertBefore(entry, eventsLog.children[1]);
        
        // é™åˆ¶æ—¥å¿—æ•°é‡
        while (eventsLog.children.length > 10) {
          eventsLog.removeChild(eventsLog.lastChild);
        }
      }
    }

    // åˆå§‹åŒ–æ‰€æœ‰æ¼”ç¤º
    createDemo('scroll1', 'target1', 'bar1', 'ratio1', 'status1', 0);
    createDemo('scroll2', 'target2', 'bar2', 'ratio2', 'status2', 0.5);
    createDemo('scroll3', 'target3', 'bar3', 'ratio3', 'status3', 1.0);
    createMultiThresholdDemo();
  </script>
</body>
</html>
