<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŸç”Ÿå®ç° - ç®€å•ç¤ºä¾‹</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f0f0f0;
        }

        .card {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        h1 {
            color: #333;
            margin-bottom: 20px;
        }

        /* è¦è½¬æ¢çš„å†…å®¹æ ·å¼ */
        #myContent {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 10px;
            text-align: center;
        }

        #myContent h2 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        #myContent p {
            font-size: 1.2em;
            margin: 10px 0;
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 10px 10px 0;
            transition: background 0.3s;
        }

        button:hover {
            background: #5568d3;
        }

        #result {
            margin-top: 20px;
        }

        #result img {
            max-width: 100%;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        .code-block {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }

        .info {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="card">
        <h1>ğŸ¯ åŸç”Ÿ DOM è½¬ Canvas - æœ€ç®€ç¤ºä¾‹</h1>
        
        <div class="info">
            <strong>ğŸ“Œ è¿™ä¸ªç¤ºä¾‹å±•ç¤ºå¦‚ä½•ä¸ä½¿ç”¨ä»»ä½•æ’ä»¶ï¼Œç”¨çº¯åŸç”Ÿ JavaScript å®ç° DOM è½¬å›¾ç‰‡</strong>
        </div>

        <!-- è¦è½¬æ¢çš„å†…å®¹ -->
        <div id="myContent">
            <h2>Hello Canvas!</h2>
            <p>è¿™æ˜¯è¦è½¬æ¢çš„å†…å®¹ âœ¨</p>
            <p>æ”¯æŒä¸­æ–‡ã€Emoji å’Œå„ç§æ ·å¼</p>
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div style="margin-top: 20px;">
            <button onclick="convertToCanvas()">è½¬æ¢ä¸º Canvas</button>
            <button onclick="convertAndDownload()">è½¬æ¢å¹¶ä¸‹è½½</button>
        </div>

        <!-- ç»“æœæ˜¾ç¤º -->
        <div id="result"></div>
    </div>

    <div class="card">
        <h2>ğŸ“ æ ¸å¿ƒä»£ç </h2>
        
        <h3>1ï¸âƒ£ åŸºç¡€ç”¨æ³•</h3>
        <div class="code-block">
// è·å–å…ƒç´ <br>
const element = document.getElementById('myContent');<br>
<br>
// è½¬æ¢ä¸º Canvas<br>
const canvas = await domToCanvas(element, {<br>
&nbsp;&nbsp;scale: 2,<br>
&nbsp;&nbsp;backgroundColor: '#ffffff'<br>
});<br>
<br>
// è½¬æ¢ä¸ºå›¾ç‰‡<br>
const imgData = canvasToImage(canvas);
        </div>

        <h3>2ï¸âƒ£ ä¸‹è½½å›¾ç‰‡</h3>
        <div class="code-block">
// ç›´æ¥ä¸‹è½½<br>
await downloadCanvas(canvas, 'my-image.png');
        </div>

        <h3>3ï¸âƒ£ æ·»åŠ æ°´å°</h3>
        <div class="code-block">
// æ·»åŠ æ°´å°<br>
const watermarkedCanvas = addWatermarkToCanvas(canvas, 'æ°´å°', {<br>
&nbsp;&nbsp;fontSize: 20,<br>
&nbsp;&nbsp;color: 'rgba(255, 255, 255, 0.3)',<br>
&nbsp;&nbsp;position: 'bottom-right'<br>
});
        </div>
    </div>

    <script src="dom-to-canvas.js"></script>
    <script>
        /**
         * è½¬æ¢ä¸º Canvas å¹¶æ˜¾ç¤º
         */
        async function convertToCanvas() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>â³ è½¬æ¢ä¸­...</p>';

            try {
                const startTime = performance.now();

                // 1. è·å–è¦è½¬æ¢çš„å…ƒç´ 
                const element = document.getElementById('myContent');

                // 2. è½¬æ¢ä¸º Canvas
                const canvas = await domToCanvas(element, {
                    scale: 2,              // 2å€åˆ†è¾¨ç‡ï¼Œæ›´æ¸…æ™°
                    backgroundColor: '#ffffff',
                    includeCss: true
                });

                const endTime = performance.now();
                const duration = (endTime - startTime).toFixed(2);

                // 3. è½¬æ¢ä¸ºå›¾ç‰‡å¹¶æ˜¾ç¤º
                const imgData = canvasToImage(canvas, 'image/png', 1.0);

                resultDiv.innerHTML = `
                    <div style="margin-top: 20px; padding: 20px; background: #f9f9f9; border-radius: 8px;">
                        <h3 style="color: #48bb78;">âœ… è½¬æ¢æˆåŠŸï¼</h3>
                        <p><strong>å°ºå¯¸ï¼š</strong>${canvas.width} Ã— ${canvas.height}px</p>
                        <p><strong>è€—æ—¶ï¼š</strong>${duration}ms</p>
                        <p><strong>å¤§å°ï¼š</strong>${Math.round(imgData.length / 1024)}KB</p>
                        <img src="${imgData}" alt="ç”Ÿæˆçš„å›¾ç‰‡">
                    </div>
                `;

                console.log('âœ… è½¬æ¢æˆåŠŸï¼', {
                    width: canvas.width,
                    height: canvas.height,
                    duration: duration + 'ms'
                });

            } catch (error) {
                console.error('âŒ è½¬æ¢å¤±è´¥:', error);
                resultDiv.innerHTML = `
                    <div style="margin-top: 20px; padding: 20px; background: #fee; border-radius: 8px; color: #c00;">
                        <h3>âŒ è½¬æ¢å¤±è´¥</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        /**
         * è½¬æ¢å¹¶ä¸‹è½½
         */
        async function convertAndDownload() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>â³ ç”Ÿæˆä¸­...</p>';

            try {
                // 1. è½¬æ¢
                const element = document.getElementById('myContent');
                const canvas = await domToCanvas(element, {
                    scale: 2,
                    backgroundColor: '#ffffff'
                });

                // 2. ä¸‹è½½
                const timestamp = Date.now();
                await downloadCanvas(canvas, `my-canvas-${timestamp}.png`);

                resultDiv.innerHTML = `
                    <div style="margin-top: 20px; padding: 20px; background: #e7ffe7; border-radius: 8px;">
                        <h3 style="color: #48bb78;">âœ… ä¸‹è½½æˆåŠŸï¼</h3>
                        <p>æ–‡ä»¶å·²ä¿å­˜åˆ°ä¸‹è½½æ–‡ä»¶å¤¹</p>
                    </div>
                `;

                console.log('âœ… ä¸‹è½½æˆåŠŸï¼');

            } catch (error) {
                console.error('âŒ ä¸‹è½½å¤±è´¥:', error);
                resultDiv.innerHTML = `
                    <div style="margin-top: 20px; padding: 20px; background: #fee; border-radius: 8px; color: #c00;">
                        <h3>âŒ ä¸‹è½½å¤±è´¥</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ¨ åŸç”Ÿ DOM è½¬ Canvas ç¤ºä¾‹å·²åŠ è½½');
            console.log('ğŸ“– ç‚¹å‡»æŒ‰é’®å¼€å§‹ä½“éªŒ');
        });
    </script>
</body>
</html>

