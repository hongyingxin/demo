<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŸç”Ÿå®ç°æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .test-section {
            background: white;
            padding: 30px;
            margin-bottom: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        h1, h2 {
            color: #333;
        }

        .test-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 8px;
            margin: 20px 0;
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        button:hover {
            background: #5568d3;
        }

        .result {
            margin-top: 20px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 6px;
        }

        .result img {
            max-width: 100%;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .log {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .log-entry {
            margin-bottom: 5px;
        }

        .success { color: #48bb78; }
        .error { color: #e53e3e; }
        .info { color: #4299e1; }
    </style>
</head>
<body>
    <h1>ğŸ§ª åŸç”Ÿ DOM è½¬ Canvas æµ‹è¯•</h1>

    <!-- æµ‹è¯•1ï¼šåŸºç¡€è½¬æ¢ -->
    <div class="test-section">
        <h2>æµ‹è¯• 1: åŸºç¡€ DOM è½¬ Canvas</h2>
        <div class="test-content" id="test1">
            <h1>Hello Canvas!</h1>
            <p>è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•å†…å®¹ã€‚</p>
            <p style="font-size: 1.5em;">æ”¯æŒä¸­æ–‡ âœ“</p>
        </div>
        <button onclick="runTest1()">è¿è¡Œæµ‹è¯• 1</button>
        <div id="result1" class="result"></div>
    </div>

    <!-- æµ‹è¯•2ï¼šå¸¦æ ·å¼çš„å…ƒç´  -->
    <div class="test-section">
        <h2>æµ‹è¯• 2: å¤æ‚æ ·å¼</h2>
        <div class="test-content" id="test2">
            <div style="display: flex; gap: 20px;">
                <div style="flex: 1; background: rgba(255,255,255,0.1); padding: 20px; border-radius: 8px;">
                    <h3>å¡ç‰‡ 1</h3>
                    <p>Flexbox å¸ƒå±€</p>
                </div>
                <div style="flex: 1; background: rgba(255,255,255,0.1); padding: 20px; border-radius: 8px;">
                    <h3>å¡ç‰‡ 2</h3>
                    <p>åœ†è§’è¾¹æ¡†</p>
                </div>
            </div>
        </div>
        <button onclick="runTest2()">è¿è¡Œæµ‹è¯• 2</button>
        <div id="result2" class="result"></div>
    </div>

    <!-- æµ‹è¯•3ï¼šæ·»åŠ æ°´å° -->
    <div class="test-section">
        <h2>æµ‹è¯• 3: æ°´å°åŠŸèƒ½</h2>
        <div class="test-content" id="test3">
            <h1>æ°´å°æµ‹è¯•</h1>
            <p>è¿™å¼ å›¾ç‰‡å°†ä¼šæ·»åŠ æ°´å°</p>
            <p>æµ‹è¯•å•ä¸ªæ°´å°å’Œå¹³é“ºæ°´å°</p>
        </div>
        <button onclick="runTest3Single()">å•ä¸ªæ°´å°</button>
        <button onclick="runTest3Tiled()">å¹³é“ºæ°´å°</button>
        <div id="result3" class="result"></div>
    </div>

    <!-- æµ‹è¯•4ï¼šä¸‹è½½åŠŸèƒ½ -->
    <div class="test-section">
        <h2>æµ‹è¯• 4: ä¸‹è½½åŠŸèƒ½</h2>
        <div class="test-content" id="test4">
            <h1>ä¸‹è½½æµ‹è¯•</h1>
            <p>ç”Ÿæˆå¹¶ä¸‹è½½ä¸º PNG å›¾ç‰‡</p>
        </div>
        <button onclick="runTest4()">ç”Ÿæˆå¹¶ä¸‹è½½</button>
        <div id="result4" class="result"></div>
    </div>

    <!-- æµ‹è¯•5ï¼šä¸åŒæ ¼å¼ -->
    <div class="test-section">
        <h2>æµ‹è¯• 5: ä¸åŒå›¾ç‰‡æ ¼å¼</h2>
        <div class="test-content" id="test5">
            <h1>æ ¼å¼æµ‹è¯•</h1>
            <p>PNG / JPEG / WebP</p>
        </div>
        <button onclick="runTest5('image/png')">PNG</button>
        <button onclick="runTest5('image/jpeg')">JPEG</button>
        <button onclick="runTest5('image/webp')">WebP</button>
        <div id="result5" class="result"></div>
    </div>

    <!-- æ—¥å¿—åŒºåŸŸ -->
    <div class="test-section">
        <h2>ğŸ“Š æµ‹è¯•æ—¥å¿—</h2>
        <div id="testLog" class="log"></div>
        <button onclick="clearLog()" style="background: #e53e3e; margin-top: 10px;">æ¸…ç©ºæ—¥å¿—</button>
    </div>

    <script src="dom-to-canvas.js"></script>
    <script>
        // æ—¥å¿—å‡½æ•°
        function log(message, type = 'info') {
            const logDiv = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            logDiv.innerHTML += `<div class="log-entry ${colorClass}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('testLog').innerHTML = '';
            log('æ—¥å¿—å·²æ¸…ç©º', 'info');
        }

        // æµ‹è¯• 1: åŸºç¡€è½¬æ¢
        async function runTest1() {
            log('å¼€å§‹æµ‹è¯• 1: åŸºç¡€ DOM è½¬ Canvas', 'info');
            const result = document.getElementById('result1');
            result.innerHTML = '<p>ç”Ÿæˆä¸­...</p>';

            try {
                const startTime = performance.now();
                const element = document.getElementById('test1');
                const canvas = await domToCanvas(element, {
                    scale: 2,
                    backgroundColor: '#ffffff'
                });
                const endTime = performance.now();
                const duration = (endTime - startTime).toFixed(2);

                const imgData = canvasToImage(canvas);
                result.innerHTML = `
                    <p>âœ… ç”ŸæˆæˆåŠŸï¼</p>
                    <p>å°ºå¯¸: ${canvas.width}x${canvas.height}ï¼Œè€—æ—¶: ${duration}ms</p>
                    <img src="${imgData}" alt="æµ‹è¯•ç»“æœ">
                `;
                log(`æµ‹è¯• 1 æˆåŠŸï¼š${canvas.width}x${canvas.height}ï¼Œè€—æ—¶ ${duration}ms`, 'success');
            } catch (error) {
                result.innerHTML = `<p style="color: red;">âŒ å¤±è´¥: ${error.message}</p>`;
                log(`æµ‹è¯• 1 å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯• 2: å¤æ‚æ ·å¼
        async function runTest2() {
            log('å¼€å§‹æµ‹è¯• 2: å¤æ‚æ ·å¼', 'info');
            const result = document.getElementById('result2');
            result.innerHTML = '<p>ç”Ÿæˆä¸­...</p>';

            try {
                const startTime = performance.now();
                const element = document.getElementById('test2');
                const canvas = await domToCanvas(element, {
                    scale: 2,
                    backgroundColor: '#ffffff',
                    includeCss: true
                });
                const endTime = performance.now();
                const duration = (endTime - startTime).toFixed(2);

                const imgData = canvasToImage(canvas);
                result.innerHTML = `
                    <p>âœ… ç”ŸæˆæˆåŠŸï¼</p>
                    <p>å°ºå¯¸: ${canvas.width}x${canvas.height}ï¼Œè€—æ—¶: ${duration}ms</p>
                    <img src="${imgData}" alt="æµ‹è¯•ç»“æœ">
                `;
                log(`æµ‹è¯• 2 æˆåŠŸï¼šå¤æ‚æ ·å¼æ¸²æŸ“å®Œæˆï¼Œè€—æ—¶ ${duration}ms`, 'success');
            } catch (error) {
                result.innerHTML = `<p style="color: red;">âŒ å¤±è´¥: ${error.message}</p>`;
                log(`æµ‹è¯• 2 å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯• 3: å•ä¸ªæ°´å°
        async function runTest3Single() {
            log('å¼€å§‹æµ‹è¯• 3: å•ä¸ªæ°´å°', 'info');
            const result = document.getElementById('result3');
            result.innerHTML = '<p>ç”Ÿæˆä¸­...</p>';

            try {
                const element = document.getElementById('test3');
                let canvas = await domToCanvas(element, {
                    scale: 2,
                    backgroundColor: '#ffffff'
                });

                canvas = addWatermarkToCanvas(canvas, '@TestWatermark', {
                    fontSize: 20,
                    color: 'rgba(255, 255, 255, 0.3)',
                    rotation: -15,
                    position: 'bottom-right'
                });

                const imgData = canvasToImage(canvas);
                result.innerHTML = `
                    <p>âœ… å•ä¸ªæ°´å°æ·»åŠ æˆåŠŸï¼</p>
                    <img src="${imgData}" alt="æµ‹è¯•ç»“æœ">
                `;
                log('æµ‹è¯• 3 æˆåŠŸï¼šå•ä¸ªæ°´å°æ·»åŠ å®Œæˆ', 'success');
            } catch (error) {
                result.innerHTML = `<p style="color: red;">âŒ å¤±è´¥: ${error.message}</p>`;
                log(`æµ‹è¯• 3 å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯• 3: å¹³é“ºæ°´å°
        async function runTest3Tiled() {
            log('å¼€å§‹æµ‹è¯• 3: å¹³é“ºæ°´å°', 'info');
            const result = document.getElementById('result3');
            result.innerHTML = '<p>ç”Ÿæˆä¸­...</p>';

            try {
                const element = document.getElementById('test3');
                let canvas = await domToCanvas(element, {
                    scale: 2,
                    backgroundColor: '#ffffff'
                });

                canvas = addTiledWatermarkToCanvas(canvas, 'WATERMARK', {
                    fontSize: 24,
                    color: 'rgba(255, 255, 255, 0.15)',
                    rotation: -30,
                    spacing: 200
                });

                const imgData = canvasToImage(canvas);
                result.innerHTML = `
                    <p>âœ… å¹³é“ºæ°´å°æ·»åŠ æˆåŠŸï¼</p>
                    <img src="${imgData}" alt="æµ‹è¯•ç»“æœ">
                `;
                log('æµ‹è¯• 3 æˆåŠŸï¼šå¹³é“ºæ°´å°æ·»åŠ å®Œæˆ', 'success');
            } catch (error) {
                result.innerHTML = `<p style="color: red;">âŒ å¤±è´¥: ${error.message}</p>`;
                log(`æµ‹è¯• 3 å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯• 4: ä¸‹è½½åŠŸèƒ½
        async function runTest4() {
            log('å¼€å§‹æµ‹è¯• 4: ä¸‹è½½åŠŸèƒ½', 'info');
            const result = document.getElementById('result4');
            result.innerHTML = '<p>ç”Ÿæˆä¸­...</p>';

            try {
                const element = document.getElementById('test4');
                const canvas = await domToCanvas(element, {
                    scale: 2,
                    backgroundColor: '#ffffff'
                });

                const timestamp = Date.now();
                await downloadCanvas(canvas, `test-${timestamp}.png`, 'image/png', 1.0);

                result.innerHTML = `<p>âœ… ä¸‹è½½æˆåŠŸï¼æ–‡ä»¶å: test-${timestamp}.png</p>`;
                log(`æµ‹è¯• 4 æˆåŠŸï¼šæ–‡ä»¶å·²ä¸‹è½½ test-${timestamp}.png`, 'success');
            } catch (error) {
                result.innerHTML = `<p style="color: red;">âŒ å¤±è´¥: ${error.message}</p>`;
                log(`æµ‹è¯• 4 å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯• 5: ä¸åŒæ ¼å¼
        async function runTest5(format) {
            log(`å¼€å§‹æµ‹è¯• 5: ${format} æ ¼å¼`, 'info');
            const result = document.getElementById('result5');
            result.innerHTML = '<p>ç”Ÿæˆä¸­...</p>';

            try {
                const element = document.getElementById('test5');
                const canvas = await domToCanvas(element, {
                    scale: 2,
                    backgroundColor: '#ffffff'
                });

                const imgData = canvasToImage(canvas, format, 0.9);
                const size = Math.round(imgData.length / 1024);
                
                result.innerHTML = `
                    <p>âœ… ${format} æ ¼å¼ç”ŸæˆæˆåŠŸï¼</p>
                    <p>æ–‡ä»¶å¤§å°: ${size}KB</p>
                    <img src="${imgData}" alt="æµ‹è¯•ç»“æœ">
                `;
                log(`æµ‹è¯• 5 æˆåŠŸï¼š${format} æ ¼å¼ï¼Œå¤§å° ${size}KB`, 'success');
            } catch (error) {
                result.innerHTML = `<p style="color: red;">âŒ å¤±è´¥: ${error.message}</p>`;
                log(`æµ‹è¯• 5 å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆ
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸ§ª æµ‹è¯•é¡µé¢å·²åŠ è½½', 'info');
            log('ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•', 'info');
        });
    </script>
</body>
</html>

